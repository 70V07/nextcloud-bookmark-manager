"use strict";const{shell:shell}=require("electron").remote,{ipcRenderer:ipcRenderer}=require("electron"),Store=require("electron-store"),store=new Store,{remote:remote}=require("electron"),dialog=remote.dialog,$=require("jquery"),dt=require("datatables.net")(window,$),keytable=require("datatables.net-keytable")(window,$);let modal,generate=require("string-to-color");const bookmarkTable=$("#bookmarks").DataTable({keys:{tabIndex:1,blurable:!0,keys:[32,38,40]},scrollY:"calc(100vh - 122px)",paging:!1,columnDefs:[{className:"dt-body-right",targets:[4,5]},{className:"padded-left",targets:[1]},{className:"dt-body-right padded-right",targets:[6]},{targets:[0],visible:!1,searchable:!1},{targets:[2],visible:store.get("tableColumns.description")},{targets:[3],visible:store.get("tableColumns.url")},{targets:[4],visible:store.get("tableColumns.created"),searchable:!1},{targets:[5],visible:store.get("tableColumns.modified"),searchable:!1}],language:{search:"",searchPlaceholder:"search"}});var total;const server=store.get("loginCredentials.server"),username=store.get("loginCredentials.username"),password=store.get("loginCredentials.password");function getBookmarks(){var e={method:"GET",headers:{Authorization:"Basic "+btoa(username+":"+password),"Content-Type":"application/json"},mode:"cors",cache:"default"};fetch(server+"/index.php/apps/bookmarks/public/rest/v2/bookmark?page=-1",e).then(function(e){if(e.ok)return console.log("response OK"),e.text();console.log("response ERROR"),console.log(e.error())}).then(function(e){var t=JSON.parse(e);"error"==t.status?showError(t.message):(total=t.data.length,parseBookmarks(t.data))}).catch(function(e){console.log("ERROR"),console.log(e)})}function parseBookmarks(e){var t=[];for(let s of e){var o="";s.tags.length<1&&s.tags.push("un-tagged");for(let e of s.tags){o+=`<span class="tag" title="${e}" style="background-color: ${"un-tagged"===e?"transparent":generate(e)};">${e}</span>`,t.push(e)}var a=new Date(1e3*s.added),r=new Date(1e3*s.lastmodified);bookmarkTable.row.add([s.id,htmlEntities(s.title),htmlEntities(s.description),s.url,a.toLocaleDateString(),r.toLocaleDateString(),o]).draw(!1)}buildTagList(t.sort())}function buildTagList(e){$(".taglist").html("");for(var t=[],o=e.slice(0),a=0;a<e.length;a++){for(var r=0,s=0;s<o.length;s++)e[a]==o[s]&&(r++,delete o[s]);if(r>0){var l=new Object;l.value=e[a],l.count=r,t.push(l)}}let n=[],i="",d=1;for(let e of t)if("un-tagged"===e.value)i=`<dd class="margin-top">\n\t\t\t\t<a href="#" class="filter" data-filter="${e.value}">${e.value}\n\t\t\t\t<span class="tag-count">${e.count}</span></a>\n\t\t\t</dd>`;else{var c=generate(e.value);$("#taglist").append(`<dd>\n\t\t\t\t<a href="#" class="filter" data-filter="${e.value}"><span class="tag" title="${e.value}" style="background-color: ${c};">${e.value}</span> ${e.value}\n\t\t\t\t<span class="tag-count">${e.count}</span></a>\n\t\t\t</dd>`),n.push({id:d,text:e.value}),d++}store.set("tags",n),$("#taglist-extras").append(`${i}\n\t\t<dd>\n\t\t\t<a href="#" class="filter selected" data-filter="">all bookmarks <span class="tag-count">${total}</span></a>\n\t\t</dd>`)}function openModal(e,t,o,a){(modal=new remote.BrowserWindow({parent:remote.getCurrentWindow(),modal:!0,width:t,minWidth:t,maxWidth:t,height:o,minHeight:o,resizable:a,show:!1,backgroundColor:"#ECECEC"})).loadURL(e),modal.once("ready-to-show",()=>{modal.show()})}function setColControls(){let e=store.get("tableColumns");for(let t in e)$(`#${t}`).prop("checked",e[t])}function htmlEntities(e){return String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;")}ipcRenderer.on("delete-bookmark",(e,t)=>{let o=!1;if(o="delete-bookmark"==t?bookmarkTable.row(".selected").data():t){if(0===dialog.showMessageBox({message:`Are you sure you want to delete the bookmark ${o[1]}?`,detail:"This operation is not reversable.",buttons:["Delete Bookmark","Cancel"]})){const e="/index.php/apps/bookmarks/public/rest/v2/bookmark/";var a={method:"DELETE",headers:{Authorization:"Basic "+btoa(username+":"+password),"Content-Type":"application/json"},mode:"cors",cache:"default"};fetch(server+e+o[0],a).then(function(e){return e.ok?e.text():(dialog.showErrorBox("Delete Bookmark Error",`An error occured whilst trying to delete the bookmark: ${o[1]}`),e.text())}).then(function(e){bookmarkTable.clear().draw(),getBookmarks()})}}else dialog.showErrorBox("Delete Bookmark Error","An entry must be selected in order to delete")}),ipcRenderer.on("edit-bookmark",(e,t)=>{let o=!1;(o="edit-bookmark"==t?bookmarkTable.row(".selected").data():t)?openModal("file://"+__dirname+"/../html/edit-bookmark.html?id="+o[0],480,340,!0):dialog.showErrorBox("Edit Bookmark Error","An entry must be selected in order to edit")}),ipcRenderer.on("open-preferences",(e,t)=>{openModal("file://"+__dirname+"/../html/login.html",480,180,!1)}),ipcRenderer.on("refresh-bookmarks",(e,t)=>{bookmarkTable.clear().draw(),getBookmarks()}),ipcRenderer.on("add-bookmark",(e,t)=>{openModal("file://"+__dirname+"/../html/add-bookmark.html",480,340,!0)}),ipcRenderer.on("close-login-modal",(e,t)=>{modal.close()}),$(document).ready(function(){getBookmarks(),setColControls(),$(".taglist").on("click",".filter",function(){$(".filter").removeClass("selected"),$(this).addClass("selected");var e=$(this).data("filter");bookmarkTable.columns(6).search(e).draw()}),$(".col-toggle").on("click",function(){let e=bookmarkTable.column($(this).attr("data-column")),t=$(this).prop("id");!0===$(this).prop("checked")?(e.visible(!0),store.set(`tableColumns.${t}`,!0)):(e.visible(!1),store.set(`tableColumns.${t}`,!1))}),$("#add-bookmark").click(function(){openModal("file://"+__dirname+"/../html/add-bookmark.html",480,340,!0)}),$("body #bookmarks tbody").on("mouseup","tr",function(e){if(3===e.which){var t=bookmarkTable.row(this).data();t&&ipcRenderer.send("show-bookmark-menu",t)}}),$("#bookmarks").on("key-focus.dt",function(e,t,o){$(bookmarkTable.row(o.index().row).node()).addClass("selected")}),$("#bookmarks").on("key-blur.dt",function(e,t,o){$(bookmarkTable.row(o.index().row).node()).removeClass("selected")}),$("#bookmarks").on("key.dt",function(e,t,o,a,r){if(32===o&&!$("#add-bookmark, .col-toggle").is(":focus")){const e=bookmarkTable.row(a.index().row).data();shell.openExternal(e[3])}}),server&&username&&password||openModal("file://"+__dirname+"/../html/login.html",480,180,!1)});
//# sourceMappingURL=maps/app.min.js.map
