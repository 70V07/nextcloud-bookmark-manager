"use strict";const remote=require("electron").remote,ipc=require("electron").ipcRenderer,dialog=remote.dialog,Store=require("electron-store"),store=new Store,$=require("jquery");require("select2")($);const urlParams=new URLSearchParams(location.search),server=store.get("loginCredentials.server"),username=store.get("loginCredentials.username"),password=store.get("loginCredentials.password"),theId=urlParams.get("id");var serialize=function(e){const t=[];for(let o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")};function getBookmark(){const e={method:"GET",headers:{Authorization:"Basic "+btoa(username+":"+password),"Content-Type":"application/json"},mode:"cors",cache:"default"};fetch(server+"/index.php/apps/bookmarks/public/rest/v2/bookmark/"+theId,e).then(function(e){return e.ok?e.text():(dialog.showErrorBox("Edit Bookmark Error","An error occured whilst trying to edit the bookmark"),closeModal(),e.text())}).then(function(e){populateForm(JSON.parse(e))}).catch(function(e){console.log("ERROR"),console.log(e)})}function populateForm(e){$("header").append(e.item.title),$('input[name="url"]').val(e.item.url),$('input[name="title"]').val(e.item.title),$('textarea[name="description"]').val(e.item.description);let t=[];const o=store.get("tags");for(var r=0;r<o.length;r++)e.item.tags.indexOf(o[r].text)>-1&&t.push(o[r].id);$("#tags").val(t),$("#tags").trigger("change")}function updateBookmark(){let e=serialize({record_id:theId,url:$('input[name="url"]').val(),title:$('input[name="title"]').val(),description:$('textarea[name="description"]').val()});const t=$("#tags").select2("data");for(var o=0;o<t.length;o++)e+="&item[tags][]="+encodeURIComponent(t[o].text);const r={method:"PUT",headers:{Authorization:"Basic "+btoa(username+":"+password),"Content-Type":"application/json"},mode:"cors",cache:"default"};fetch(server+"/index.php/apps/bookmarks/public/rest/v2/bookmark/"+theId+"?"+e,r).then(function(e){return e.ok?e.text():(dialog.showErrorBox("Edit Bookmark Error","An error occured whilst trying to edit the bookmark"),closeModal(),e.text())}).then(function(e){ipc.send("refresh","refresh"),closeModal()}).catch(function(e){console.log("ERROR"),console.log(e)})}function closeModal(){remote.getCurrentWindow().close()}$(document).ready(function(){$("#tags").select2({theme:"custom",width:"320px",tags:!0,tokenSeparators:[",",";"],data:store.get("tags")}),getBookmark(),$("#cancel").click(function(){closeModal()}),$("#modal-form").submit(function(e){e.preventDefault(),updateBookmark()})});
//# sourceMappingURL=maps/edit-bookmark.min.js.map
