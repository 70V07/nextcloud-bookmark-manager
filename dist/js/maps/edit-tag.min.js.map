{"version":3,"sources":["edit-tag.js"],"names":["remote","require","ipc","ipcRenderer","dialog","Store","store","$","urlParams","URLSearchParams","location","search","server","get","username","password","theTag","serialize","obj","str","p","hasOwnProperty","push","encodeURIComponent","join","populateForm","append","val","attr","updateTag","query","old_name","new_name","editInit","method","headers","Authorization","btoa","Content-Type","mode","cache","fetch","then","response","ok","text","showErrorBox","closeModal","message","send","catch","error","console","log","getCurrentWindow","close","document","ready","click","submit","e","preventDefault"],"mappings":"AAAA,aAEA,MAAMA,OAASC,QAAS,YAAaD,OAC/BE,IAAMD,QAAS,YAAaE,YAC5BC,OAASJ,OAAOI,OAEhBC,MAAQJ,QAAS,kBACjBK,MAAQ,IAAID,MAEZE,EAAIN,QAAS,UAEbO,UAAY,IAAIC,gBAAiBC,SAASC,QAMzCC,OAAWN,MAAMO,IAAK,2BAC3BC,SAAYR,MAAMO,IAAK,6BACvBE,SAAYT,MAAMO,IAAK,6BAMnBG,OAASR,UAAUK,IAAI,OAM7B,IAAII,UAAY,SAAUC,GAEzB,MAAMC,EAAM,GAEZ,IAAM,IAAIC,KAAKF,EAETA,EAAIG,eAAeD,IAEvBD,EAAIG,KAAMC,mBAAmBH,GAAK,IAAMG,mBAAmBL,EAAIE,KAGjE,OAAOD,EAAIK,KAAK,MAOjB,SAASC,eAERlB,EAAE,UAAUmB,OAAQV,QACpBT,EAAE,0BAA0BoB,IAAKX,QACjCT,EAAE,0BAA0BqB,KAAK,cAAeZ,QAAQY,KAAK,UAAW,OAASZ,OAAS,QAO3F,SAASa,YAEOtB,EAAE,0BAA0BoB,MAClCpB,EAAE,0BAA0BoB,MAErC,IAAIG,EAAQb,UAAU,CAEpBc,SAAYxB,EAAE,0BAA0BoB,MACxCK,SAAYzB,EAAE,0BAA0BoB,QAG1C,MAEMM,EAAW,CAEhBC,OAAQ,OACRC,QAAS,CACRC,cAAiB,SAAWC,KAAMvB,SAAW,IAAMC,UACnDuB,eAAgB,oBAEjBC,KAAM,OACNC,MAAO,WAGRC,MAAM7B,OAbU,gDAaekB,EAAOG,GAAUS,KAAK,SAASC,GAE7D,OAAIA,EAASC,GAELD,EAASE,QAIhBzC,OAAO0C,aACN,iBACA,kDAGDC,aACOJ,EAASE,UAGfH,KAAK,SAASM,GAEhB9C,IAAI+C,KAAK,UAAW,WACpBF,eAEEG,MAAM,SAASC,GAEjBC,QAAQC,IAAI,SACZD,QAAQC,IAAIF,KAQd,SAASJ,aAEM/C,OAAOsD,mBACfC,QAKPhD,EAAEiD,UAAUC,MAAM,WAEjBhC,eAIAlB,EAAE,WAAWmD,MAAO,WAEnBX,eAODxC,EAAE,eAAeoD,OAAQ,SAAUC,GAElCA,EAAEC,iBACFhC","file":"../edit-tag.min.js","sourcesContent":["'use strict'\n\nconst remote = require( 'electron' ).remote\nconst ipc = require( 'electron' ).ipcRenderer\nconst dialog = remote.dialog\n\nconst Store = require( 'electron-store' )\nconst store = new Store()\n\nconst $ = require( 'jquery' )\n\nconst urlParams = new URLSearchParams( location.search )\n\n\n\n//note(@duncanmid): get login credentials\n\nconst \tserver \t\t= store.get( 'loginCredentials.server' ),\n\t\tusername \t= store.get( 'loginCredentials.username' ),\n\t\tpassword \t= store.get( 'loginCredentials.password' )\n\n\n\n//note(@duncanmid): old tag\n\nconst theTag = urlParams.get('tag')\n\n\n\n//note(@duncanmid): serialize object\n\nvar serialize = function( obj ) {\n\t\n\tconst str = []\n\t\n\tfor ( let p in obj )\n\t\n\t\tif ( obj.hasOwnProperty(p) ) {\n\t\t\t\n\t\t\tstr.push( encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]) )\n\t\t}\n\t\n\treturn str.join(\"&\")\n}\n\n\n\n//note(@duncanmid): populate form\n\nfunction populateForm() {\n\t\n\t$('header').append( theTag )\n\t$('input[name=\"old_name\"]').val( theTag )\n\t$('input[name=\"new_name\"]').attr('placeholder', theTag).attr(\"pattern\", '^(?!' + theTag + '$).*')\n}\n\n\n\n//note(@duncanmid): update tag\n\nfunction updateTag() {\n\t\n\tconst oldTag = $('input[name=\"new_name\"]').val(),\n\tnewTag = $('input[name=\"old_name\"]').val()\n\t\n\tlet query = serialize({\n\t\n\t\t\t'old_name': $('input[name=\"old_name\"]').val(),\n\t\t\t'new_name': $('input[name=\"new_name\"]').val()\n\t\t})\n\t\t\n\tconst editUrl = \"/index.php/apps/bookmarks/public/rest/v2/tag\"\n\t\n\tconst editInit = {\n\t\t\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Authorization': 'Basic ' + btoa( username + ':' + password ),\n\t\t\t'Content-Type': 'application/json'\n\t\t},\n\t\tmode: 'cors',\n\t\tcache: 'default'\n\t}\n\t\n\tfetch(server + editUrl + '?' + query, editInit).then(function(response) {\n\t\t\n\t\tif (response.ok) {\n\t\t\t\n\t\t\treturn response.text()\n\t\t\n\t\t} else {\n\t\t\t\n\t\t\tdialog.showErrorBox(\n\t\t\t\t'Edit Tag Error',\n\t\t\t\t`An error occured whilst trying to edit the tag`\n\t\t\t)\n\t\t\t\n\t\t\tcloseModal()\n\t\t\treturn response.text()\n\t\t}\n\t\n\t}).then(function(message) {\n\t\t\n\t\tipc.send('refresh', 'refresh')\n\t\tcloseModal()\t\n\t\n\t}).catch(function(error) {\n\t\t\n\t\tconsole.log('ERROR')\n\t\tconsole.log(error)\n\t})\n}\n\n\n\n//note(@duncanmid): close modal\n\nfunction closeModal() {\n\t\n\tconst modal = remote.getCurrentWindow()\n\tmodal.close()\n}\n\n\n\n$(document).ready(function() {\n\t\n\tpopulateForm()\n\t\n\t//note(@duncanmid): cancel modal\n\t\n\t$('#cancel').click( function() {\n\t\t\n\t\tcloseModal()\n\t})\n\t\n\t\n\t\n\t//note(@duncanmid): update data\n\t\n\t$('#modal-form').submit( function( e ) {\n\t\t\n\t\te.preventDefault()\n\t\tupdateTag()\n\t})\n})\n"]}