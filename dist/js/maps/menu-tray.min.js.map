{"version":3,"names":[],"mappings":"","sources":["menu-tray.js"],"sourcesContent":["'use strict'\n\nconst {\n\tapp,\n\tBrowserWindow,\n\tipcMain,\n\tMenu,\n\tTray,\n\tshell\n} = require( 'electron' )\n\nconst path \t\t= require( 'path' )\nconst fs \t\t= require( 'fs-extra' )\nconst log\t\t= require( 'electron-log' )\nconst Store\t\t= require( 'electron-store' )\nconst store \t= new Store()\nconst isUrl \t= require( 'is-url' )\n\nconst favicon \t= require( './favicon.min' )\nconst dir \t\t= store.get( 'dirPath' )\n\nlet trayIcon \t= null,\n\tbookmarks \t= new Store( {name: 'bookmarks'} )\n\t\n\t\n\nipcMain.on( 'tray-menu', (event) => {\n\t\n\tif( trayIcon !== null ) trayIcon.destroy()\n\t\n\tlet bookmarkdata \t= bookmarks.get( 'data' ),\n\t\tfolders \t\t= store.get( 'folders' )\n\t\n\tfolders.sort((a,b) => (a.text > b.text) ? 1 : ((b.text > a.text) ? -1 : 0))\n\t\n\tconst \ticonPath \t= path.join( __dirname , '../assets/png/iconTemplate.png' ),\n\t\t\tfolderPath \t= path.join( __dirname , '../assets/png/folderTemplate.png' )\n\t\n\ttrayIcon = new Tray( iconPath )\n\t\n\tconst trayMenuTemplate = []\n\t\n\tfor( let folder of folders ) {\n\t\t\n\t\ttrayMenuTemplate.push({\n\t\t\tlabel: folder.text,\n\t\t\tid: folder.id,\n\t\t\ticon: folderPath,\n\t\t\tsubmenu: []\n\t\t})\n\t}\n\t\n\ttrayMenuTemplate.push({ type: 'separator' })\n\t\n\tfor( let bookmark of bookmarkdata ) {\n\t\t\n\t\tfor( let id of bookmark.folders  ) {\n\t\t\t\n\t\t\tif( id === -1 ) {\n\t\t\t\t\n\t\t\t\ttrayMenuTemplate.push({\n\t\t\t\t\tlabel: bookmark.title,\n\t\t\t\t\ticon: favicon.exists( bookmark.id ),\n\t\t\t\t\tclick () {\n\t\t\t\t\t\tshell.openExternal( bookmark.url )\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\tlet submenu = trayMenuTemplate.find(x => x.id === id).submenu\n\t\t\t\t\n\t\t\t\tsubmenu.push({\n\t\t\t\t\tlabel: bookmark.title,\n\t\t\t\t\ticon: favicon.exists( bookmark.id ),\n\t\t\t\t\tclick () {\n\t\t\t\t\t\tshell.openExternal( bookmark.url )\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\t\n\tconst trayMenu = Menu.buildFromTemplate( trayMenuTemplate )\n\ttrayIcon.setContextMenu( trayMenu )\n\t\n\ttrayIcon.on('drop-text', (event, text) => {\n\t\t\n\t\tif( isUrl( text ) ) {\n\t\t\n\t\t\tlet win = BrowserWindow.fromId(1)\n\t\t\twin.show()\n\t\t\twin.webContents.send( 'drop-on-tray', { \"url\": text, \"title\": '' } )\n\t\t}\n\t})\n\t\n\ttrayIcon.on('drop-files', (event, files) => {\n\t\t\n\t\tif( path.extname( files[0] ) === '.webloc' ) {\n\t\t\n\t\t\tlet name = path.basename( files[0], '.webloc' )\n\t\t\t\n\t\t\tfs.readFile( files[0], 'utf8', (err, data ) => {\n\t\t\t\t\n\t\t\t\tif ( err ) {\n\t\t\t\t\t\n\t\t\t\t\tlog.error( err )\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlet loc = data.match( '\\<string\\>(.*?)\\<\\/string\\>' )\n\t\t\t\t\n\t\t\t\tlet win = BrowserWindow.fromId(1)\n\t\t\t\twin.show()\n\t\t\t\twin.webContents.send( 'drop-on-tray', { \"url\": loc[1], \"title\": name } )\n\t\t\t\t\n\t\t\t})\n\t\t}\n\t})\n})\n"],"file":"../menu-tray.min.js"}