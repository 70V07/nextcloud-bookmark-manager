{"version":3,"sources":["add-bookmark.js"],"names":["remote","require","ipc","ipcRenderer","dialog","Store","store","$","server","get","username","password","serialize","obj","str","p","hasOwnProperty","push","encodeURIComponent","join","addBookmark","query","url","val","title","description","tags","select2","i","length","addInit","method","headers","Authorization","btoa","Content-Type","mode","cache","fetch","then","response","ok","text","showErrorBox","message","send","closeModal","catch","error","console","log","getCurrentWindow","close","document","ready","theme","width","tokenSeparators","data","click","submit","e","preventDefault"],"mappings":"AAAA,aAEA,MAAMA,OAASC,QAAS,YAAaD,OAC/BE,IAAMD,QAAS,YAAaE,YAC5BC,OAASJ,OAAOI,OAEhBC,MAAQJ,QAAS,kBACjBK,MAAQ,IAAID,MAEZE,EAAIN,QAAS,UACnBA,QAAQ,UAARA,CAAmBM,GAMnB,MAAOC,OAAWF,MAAMG,IAAK,2BAC3BC,SAAYJ,MAAMG,IAAK,6BACvBE,SAAYL,MAAMG,IAAK,6BAMzB,IAAIG,UAAY,SAAUC,GAEzB,MAAMC,KAEN,IAAM,IAAIC,KAAKF,EAETA,EAAIG,eAAeD,IAEvBD,EAAIG,KAAMC,mBAAmBH,GAAK,IAAMG,mBAAmBL,EAAIE,KAGjE,OAAOD,EAAIK,KAAK,MAOjB,SAASC,cAER,IAAIC,EAAQT,WAEXU,IAAOf,EAAE,qBAAqBgB,MAC9BC,MAASjB,EAAE,uBAAuBgB,MAClCE,YAAelB,EAAE,gCAAgCgB,QAIlD,MAAMG,EAAOnB,EAAE,SAASoB,QAAQ,QAEhC,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAKG,OAAQD,IAEhCP,GAAS,iBAAmBH,mBAAmBQ,EAAKE,GAAS,MAI9D,MAEME,GAELC,OAAQ,OACRC,SACCC,cAAiB,SAAWC,KAAMxB,SAAW,IAAMC,UACnDwB,eAAgB,oBAEjBC,KAAM,OACNC,MAAO,WAIRC,MAAM9B,OAdS,qDAcea,EAAOS,GAASS,KAAK,SAASC,GAE3D,OAAIA,EAASC,GAELD,EAASE,QAIhBtC,OAAOuC,aACN,qBACA,sDAGMH,EAASE,UAGfH,KAAK,SAASK,GAEhB1C,IAAI2C,KAAK,UAAW,WACpBC,eAEEC,MAAM,SAASC,GAEjBC,QAAQC,IAAI,SACZD,QAAQC,IAAIF,KAQd,SAASF,aAEM9C,OAAOmD,mBACfC,QAKP7C,EAAE8C,UAAUC,MAAM,WAGjB/C,EAAE,SAASoB,SACV4B,MAAO,SACPC,MAAO,QACP9B,MAAM,EACN+B,iBAAkB,IAAI,KACtBC,KAAMpD,MAAMG,IAAI,UAOjBF,EAAE,WAAWoD,MAAO,WAEnBb,eAODvC,EAAE,eAAeqD,OAAQ,SAAUC,GAElCA,EAAEC,iBACF1C","file":"../add-bookmark.min.js","sourcesContent":["'use strict'\n\nconst remote = require( 'electron' ).remote\nconst ipc = require( 'electron' ).ipcRenderer\nconst dialog = remote.dialog\n\nconst Store = require( 'electron-store' )\nconst store = new Store()\n\nconst $ = require( 'jquery' )\nrequire('select2')($)\n\n\n\n//note(@duncanmid): get login credentials\n\nconst \tserver \t\t= store.get( 'loginCredentials.server' ),\n\t\tusername \t= store.get( 'loginCredentials.username' ),\n\t\tpassword \t= store.get( 'loginCredentials.password' )\n\n\n\n//note(@duncanmid): serialize object\n\nvar serialize = function( obj ) {\n\t\n\tconst str = []\n\t\n\tfor ( let p in obj )\n\t\n\t\tif ( obj.hasOwnProperty(p) ) {\n\t\t\t\n\t\t\tstr.push( encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]) )\n\t\t}\n\t\n\treturn str.join(\"&\")\n}\n\n\n\n//note(@duncanmid): add function\n\nfunction addBookmark() {\n\t\n\tlet query = serialize({\n\t\t\n\t\t'url': $('input[name=\"url\"]').val(),\n\t\t'title': $('input[name=\"title\"]').val(),\n\t\t'description': $('textarea[name=\"description\"]').val()\n\t\t\n\t})\n\t\n\tconst tags = $('#tags').select2('data')\n\t\n\tfor (var i = 0; i < tags.length; i++) {\n\t\t\t\n\t\tquery += '&item[tags][]=' + encodeURIComponent(tags[i]['text'])\n\t\t\t\n\t}\n\t\n\tconst addUrl = \"/index.php/apps/bookmarks/public/rest/v2/bookmark\"\n\t\t\n\tconst addInit = {\n\t\t\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Authorization': 'Basic ' + btoa( username + ':' + password ),\n\t\t\t'Content-Type': 'application/json'\n\t\t},\n\t\tmode: 'cors',\n\t\tcache: 'default'\n\t}\n\t\n\t\n\tfetch(server + addUrl + '?' + query, addInit).then(function(response) {\n\t\t\n\t\tif (response.ok) {\n\t\t\t\n\t\t\treturn response.text()\n\t\t\n\t\t} else {\n\t\t\t\n\t\t\tdialog.showErrorBox(\n\t\t\t\t'Add Bookmark Error',\n\t\t\t\t'An error occured whilst trying to add the bookmark'\n\t\t\t)\n\t\t\t\n\t\t\treturn response.text()\n\t\t}\n\t\n\t}).then(function(message) {\n\t\t\n\t\tipc.send('refresh', 'refresh')\n\t\tcloseModal()\t\n\t\n\t}).catch(function(error) {\n\t\t\n\t\tconsole.log('ERROR')\n\t\tconsole.log(error)\n\t})\n}\n\n\n\n//note(@duncanmid): close modal\n\nfunction closeModal() {\n\t\n\tconst modal = remote.getCurrentWindow()\n\tmodal.close()\n}\n\n\n\n$(document).ready(function() {\n\t\n\t\n\t$('#tags').select2({\n\t\ttheme: \"custom\",\n\t\twidth: '320px',\n\t\ttags: true,\n\t\ttokenSeparators: [',',';'],\n\t\tdata: store.get('tags')\n\t})\n\t\n\t\n\t\n\t//note(@duncanmid): cancel modal\n\t\n\t$('#cancel').click( function() {\n\t\t\n\t\tcloseModal()\n\t})\n\t\n\t\n\t\n\t//note(@duncanmid): update data\n\t\n\t$('#modal-form').submit( function( e ) {\n\t\t\n\t\te.preventDefault()\n\t\taddBookmark()\t\n\t})\n})\n"]}