{"version":3,"sources":["app.js"],"names":["shell","require","remote","ipcRenderer","Store","store","dialog","$","dt","window","keytable","generate","bookmarkTable","DataTable","keys","tabIndex","blurable","scrollY","paging","columnDefs","className","targets","visible","searchable","get","language","search","searchPlaceholder","total","server","username","password","getBookmarks","getInit","method","headers","Authorization","btoa","Content-Type","mode","cache","fetch","then","response","ok","console","log","text","error","message","doc","JSON","parse","showError","data","length","parseBookmarks","catch","array","allTags","item","taglist","tags","push","tagitem","created","Date","added","modified","lastmodified","row","add","id","title","description","url","toLocaleDateString","draw","buildTagList","sort","html","compressed","copy","slice","i","myCount","w","a","Object","value","count","results","untagged","color","append","set","openModal","modal","BrowserWindow","parent","getCurrentWindow","width","height","resizable","show","backgroundColor","loadURL","once","setColControls","cols","col","prop","on","event","bookmark","showMessageBox","detail","buttons","deleteUrl","deleteInit","showErrorBox","clear","__dirname","document","ready","removeClass","this","addClass","columns","column","attr","click","which","send","e","datatable","cell","index","node","key","originalEvent","is","openExternal"],"mappings":"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","file":"../app.min.js","sourcesContent":["'use strict'\n\n\nconst {shell} = require('electron').remote\nconst {ipcRenderer} = require( 'electron' )\n\nconst Store = require( 'electron-store' )\nconst store = new Store()\n\nconst { remote } = require('electron')\nconst dialog = remote.dialog\n\nconst $ = require( 'jquery' )\nconst dt = require( 'datatables.net' )( window, $ )\nconst keytable = require( 'datatables.net-keytable' )( window, $ )\n\nlet generate = require('string-to-color')\n\nconst bookmarkTable = $('#bookmarks').DataTable({\n\t\n\tkeys: {\n\t\ttabIndex: 1,\n\t\tblurable: true,\n\t\tkeys: [ \t32, // space\n\t\t\t\t\t38, // up\n\t\t\t\t\t40  // down\n\t\t]\n\t},\n\t\n\tscrollY: \t'calc(100vh - 122px)',\n\tpaging: \tfalse,\n\t\"columnDefs\":\n\t\t\n\t\t[\n\t\t\t{ \tclassName: \"dt-body-right\",\n\t\t\t\t\"targets\": [ 4, 5 ]\n\t\t\t},\n\t\t\t{\n\t\t\t\tclassName: \"padded-left\",\n\t\t\t\t\"targets\": [ 1 ]\t\n\t\t\t},\n\t\t\t{\n\t\t\t\tclassName: \"dt-body-right padded-right\",\n\t\t\t\t\"targets\": [ 6 ]\t\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"targets\": [ 0 ],\n\t\t\t\t\"visible\": false,\n\t\t\t\t\"searchable\": false\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"targets\": [ 2 ],\n\t\t\t\t\"visible\": store.get('tableColumns.description')\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"targets\": [ 3 ],\n\t\t\t\t\"visible\": store.get('tableColumns.url')\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"targets\": [ 4 ],\n\t\t\t\t\"visible\": store.get('tableColumns.created'),\n\t\t\t\t\"searchable\": false\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"targets\": [ 5 ],\n\t\t\t\t\"visible\": store.get('tableColumns.modified'),\n\t\t\t\t\"searchable\": false\n\t\t\t}\n\t\t],\n\t\n\t\"language\": {\n\t\t\"search\": \"\",\n\t\t\"searchPlaceholder\": \"search\"\n\t}\n})\n\n\nvar total\n\n//note(@duncanmid): get login credentials\n\nconst \tserver \t\t= store.get( 'loginCredentials.server' ),\n\t\tusername \t= store.get( 'loginCredentials.username' ),\n\t\tpassword \t= store.get( 'loginCredentials.password' )\n\n\n//note(@duncanmid): get bookmark json\n\nfunction getBookmarks() {\n\t\n\tconst getUrl = \"/index.php/apps/bookmarks/public/rest/v2/bookmark?page=-1\"\n\t\n\tvar getInit = {\n\t\t\n\t\tmethod: 'GET',\n\t\theaders: {\n\t\t\t'Authorization': 'Basic ' + btoa( username + ':' + password ),\n\t\t\t'Content-Type': 'application/json'\n\t\t},\n\t\tmode: 'cors',\n\t\tcache: 'default'\n\t}\n\t\n\t\n\tfetch(server + getUrl, getInit).then(function(response) {\n\t\t\n\t\tif (response.ok) {\n\t\t\t\n\t\t\tconsole.log('response OK')\n\t\t\treturn response.text()\n\t\t\n\t\t} else {\n\t\t\t\n\t\t\tconsole.log('response ERROR')\n\t\t\tconsole.log( response.error() )\n\t\t}\n\t\n\t}).then(function(message) {\n\t\t\n\t\tvar doc = JSON.parse(message)\n\t\t\n\n\t\tif (doc['status'] == 'error') {\n\t\t\t\n\t\t\tshowError(doc['message'])\n\t\t\n\t\t\n\t\t} else {\n\t\t\t\n\t\t\ttotal = doc.data.length\n\t\t\t\n\t\t\tparseBookmarks( doc.data )\n\t\t}\n\t\n\t}).catch(function(error) {\n\t\t\n\t\tconsole.log('ERROR')\n\t\tconsole.log(error)\n\t})\n}\n\n\n\n//note(@duncanmid): populate dataTable\n\nfunction parseBookmarks( array ) {\n\t\n\tvar allTags = []\n\t\n\tfor ( let item of array ) {\n\t\t\n\t\tvar taglist = ''\n\t\t\n\t\tif( item.tags.length < 1 ) { item.tags.push('un-tagged') }\n\t\t\n\t\tfor ( let tagitem of item.tags ) {\n\t\t\n\t\t\tvar color\n\t\t\t\n\t\t\tif( tagitem === 'un-tagged' ) {\n\t\t\t\t\n\t\t\t\tcolor = 'transparent'\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\tcolor = generate(tagitem)\n\t\t\t}\n\t\t\t\n\t\t\ttaglist += `<span class=\"tag\" title=\"${tagitem}\" style=\"background-color: ${color};\">${tagitem}</span>`\n\t\t\t\n\t\t\tallTags.push( tagitem )\n\t\t}\n\t\t\n\t\tvar created = \tnew Date( item.added * 1000 ),\n\t\t\tmodified = \tnew Date( item.lastmodified * 1000 )\n\t\t\t\n\t\t\n\t\tbookmarkTable.row.add( [\n\t\t\t\n\t\t\titem.id,\n\t\t\titem.title,\n\t\t\titem.description,\n\t\t\titem.url,\n\t\t\tcreated.toLocaleDateString(),\n\t\t\tmodified.toLocaleDateString(),\n\t\t\ttaglist\n\t\t\n\t\t]).draw( false )\n\t}\n\t\n\tbuildTagList( allTags.sort() )\n}\n\n\n\n//note(@duncanmid): get list of tags with count\n\nfunction buildTagList( array ) {\n\t\n\t//clear the taglists first\n\t$('.taglist').html( '' )\n\t\n\tvar compressed = []\n\tvar copy = array.slice(0)\n\t\n\tfor (var i = 0; i < array.length; i++) {\n\t\n\t\tvar myCount = 0\n\t\t\n\t\tfor (var w = 0; w < copy.length; w++) {\n\t\t\t\n\t\t\tif (array[i] == copy[w]) {\n\t\t\t\t\n\t\t\t\tmyCount++\n\t\t\t\tdelete copy[w]\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (myCount > 0) {\n\t\t\t\n\t\t\tvar a = new Object()\n\t\t\ta.value = array[i]\n\t\t\ta.count = myCount\n\t\t\tcompressed.push(a)\n\t\t}\n\t}\n\t\n\t\n\tlet results = [],\n\tuntagged = '',\n\tcount = 1\n\t\n\tfor ( let tagitem of compressed ) {\n\t\t\n\t\tif( tagitem.value === 'un-tagged' ) {\n\t\t\t\n\t\t\tuntagged =\n\t\t\t\n\t\t\t`<dd class=\"margin-top\">\n\t\t\t\t<a href=\"#\" class=\"filter\" data-filter=\"${tagitem.value}\">${tagitem.value}\n\t\t\t\t<span class=\"tag-count\">${tagitem.count}</span></a>\n\t\t\t</dd>`\n\t\t\n\t\t} else {\n\t\t\t\n\t\t\tvar color = generate(tagitem.value)\n\t\t\t\n\t\t\t$('#taglist').append(\n\t\t\t\n\t\t\t`<dd>\n\t\t\t\t<a href=\"#\" class=\"filter\" data-filter=\"${tagitem.value}\"><span class=\"tag\" title=\"${tagitem.value}\" style=\"background-color: ${color};\">${tagitem.value}</span> ${tagitem.value}\n\t\t\t\t<span class=\"tag-count\">${tagitem.count}</span></a>\n\t\t\t</dd>`\n\t\t\t)\n\t\t\t\n\t\t\tresults.push( { \"id\": count , \"text\": tagitem.value } )\n\t\t\tcount++;\n\t\t}\n\t}\n\t\n\t\n\tstore.set('tags', results )\n\t\n\t\n\t$('#taglist-extras').append(\n\t\t\n\t\t`${untagged}\n\t\t<dd>\n\t\t\t<a href=\"#\" class=\"filter selected\" data-filter=\"\">all bookmarks <span class=\"tag-count\">${total}</span></a>\n\t\t</dd>`\n\t)\n}\n\n\n\n//note(@duncanmid): delete bookmark\n\nipcRenderer.on('delete-bookmark', (event, message) => {\n\t\n\tlet bookmark = false;\n\t\n\tif( message == 'delete-bookmark' ) {\n\t\t\n\t\tbookmark = bookmarkTable.row('.selected').data()\n\t\n\t} else {\n\t\t\n\t\tbookmark = message\n\t}\n\t\n\t\n\tif( bookmark ) {\n\t\n\t\tvar response = dialog.showMessageBox({\t\n\t\t\t\t\t\t\tmessage: `Are you sure you want to delete the bookmark ${bookmark[1]}?`,\n\t\t\t\t\t\t\tdetail: 'This operation is not reversable.',\n\t\t\t\t\t\t\tbuttons: ['Delete Bookmark','Cancel']\n\t\t\t\t\t\t})\n\t\t\n\t\tif( response === 0 ) {\n\t\t\n\t\t\tconst deleteUrl = \"/index.php/apps/bookmarks/public/rest/v2/bookmark/\"\n\t\t\t\n\t\t\tvar deleteInit = {\n\t\t\t\t\n\t\t\t\tmethod: 'DELETE',\n\t\t\t\theaders: {\n\t\t\t\t\t'Authorization': 'Basic ' + btoa( username + ':' + password ),\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tmode: 'cors',\n\t\t\t\tcache: 'default'\n\t\t\t}\n\t\t\t\n\t\t\tfetch(server + deleteUrl + bookmark[0], deleteInit).then(function(response) {\n\t\t\t\t\n\t\t\t\tif (response.ok) {\n\t\t\t\t\t\n\t\t\t\t\treturn response.text()\n\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\t\n\t\t\t\t\tdialog.showErrorBox(\n\t\t\t\t\t\t'Delete Bookmark Error',\n\t\t\t\t\t\t`An error occured whilst trying to delete the bookmark: ${bookmark[1]}`\n\t\t\t\t\t)\n\t\t\t\t\t\n\t\t\t\t\treturn response.text()\n\t\t\t\t}\n\t\t\t\n\t\t\t}).then(function(message) {\n\t\t\t\t\n\t\t\t\tbookmarkTable.clear().draw()\n\t\t\t\tgetBookmarks()\n\t\t\t})\n\t\t}\n\t\n\t} else {\n\t\t\n\t\tdialog.showErrorBox(\n\t\t\t'Delete Bookmark Error',\n\t\t\t'An entry must be selected in order to delete'\n\t\t)\n\t}\n})\n\n\n\n//note(@duncanmid): edit bookmark\n\nipcRenderer.on('edit-bookmark', (event, message) => {\n\t\n\tlet bookmark = false;\n\t\n\tif( message == 'edit-bookmark' ) {\n\t\t\n\t\tbookmark = bookmarkTable.row('.selected').data()\n\t\n\t} else {\n\t\t\n\t\tbookmark = message\n\t}\n\t\n\t\n\tif( bookmark ) {\n\t\t\n\t\topenModal( 'file://' + __dirname + '/../html/edit-bookmark.html?id=' + bookmark[0] )\n\t\t\n\t} else {\n\t\t\n\t\tdialog.showErrorBox(\n\t\t\t'Edit Bookmark Error',\n\t\t\t'An entry must be selected in order to edit'\n\t\t)\n\t}\n})\n\n\n\n//note(@duncanmid): preferences modal\n\nipcRenderer.on('open-preferences', (event, message) => {\n\t\n\topenModal( 'file://' + __dirname + '/../html/preferences.html' )\n})\n\n\n\n//note(@duncanmid): refresh bookmarks\n\nipcRenderer.on('refresh-bookmarks', (event, message) => {\n\t\n\tbookmarkTable.clear().draw()\n\tgetBookmarks()\n})\n\n\n//note(@duncanmid): add bookmark\n\nipcRenderer.on('add-bookmark', (event, message) => {\n\t\n\topenModal( 'file://' + __dirname + '/../html/add-bookmark.html' )\n})\n\n\n\n//note(@duncanmid): modal\n\nfunction openModal( url ) {\n\t\n\tlet modal = new remote.BrowserWindow({\n\t\t\n\t\t\tparent: remote.getCurrentWindow(),\n\t\t\tmodal: true,\n\t\t\twidth: 480,\n\t\t\theight: 320,\n\t\t\tresizable: false,\n\t\t\tshow: false,\n\t\t\tbackgroundColor: '#ECECEC'\n\t\t})\n\t\t\n\t\tmodal.loadURL( url )\n\t\t\n\t\tmodal.once('ready-to-show', () => {\n\t\t\t\n\t\t\tmodal.show()\n\t\t})\n}\n\n\n\n//note(@duncanmid): set column checkboxes\n\nfunction setColControls() {\n\t\n\tlet cols = store.get('tableColumns')\n\t\n\tfor (let col in cols) {\n\t\t\n\t\t$(`#${col}`).prop('checked', cols[col])\n\t\t\n\t}\n}\n\n\n\n$(document).ready(function() {\n\t\n\tgetBookmarks()\n\tsetColControls()\n\t\n\t\n\t//note(@duncanmid): click tag list item to filter table\n\t\n\t$('.taglist').on('click', '.filter', function() {\n\t\t\n\t\t$('.filter').removeClass('selected')\n\t\t$(this).addClass('selected')\n\t\t\n\t\tvar data = $(this).data('filter')\n\t\tbookmarkTable.columns(6).search(data).draw()\n\t})\n\t\n\t\n\t//note(@duncanmid): toggle col visibility\n\t\n\t$('.col-toggle').on( 'click', function () {\n\t\t\n\t\tlet column \t= bookmarkTable.column( $(this).attr('data-column') ),\n\t\t\tid \t\t= $(this).prop( 'id' )\n\t\t\n\t\tif( $(this).prop('checked') === true ) {\n\t\t\t\n\t\t\tcolumn.visible( true )\n\t\t\tstore.set( `tableColumns.${id}`, true )\n\t\t\n\t\t} else {\n\t\t\t\n\t\t\tcolumn.visible( false )\n\t\t\tstore.set( `tableColumns.${id}`, false )\n\t\t}\n\t})\n\t\n\t\n\t//note(@duncanmid): add bookmark\n\t\n\t$( '#add-bookmark' ).click( function() {\n\t\t\n\t\topenModal( 'file://' + __dirname + '/../html/add-bookmark.html' )\n\t})\n\t\n\t\n\t//note(@duncanmid): show context menu\n\t\n\t$('body #bookmarks tbody').on('mouseup', 'tr', function(event) {\n\t\t\n\t\tif( event.which === 3 ) {\n\t\t\t\n\t\t\tvar data = bookmarkTable.row( this ).data()\n\t\t\t\n\t\t\tif( data ) {\n\t\t\t\n\t\t\t\tipcRenderer.send('show-bookmark-menu', data )\n\t\t\t}\n\t\t}\n\t})\n\t\n\t\n\t//note(@duncanmid): highlight row\n\t\n\t$('#bookmarks').on('key-focus.dt', function(e, datatable, cell) {\n\t\n\t\t$(bookmarkTable.row(cell.index().row).node()).addClass('selected')\n\t})\n\t\n\t\n\t//note(@duncanmid): remove hilight\n\t\n\t$('#bookmarks').on('key-blur.dt', function(e, datatable, cell) {\n\t\n\t\t$(bookmarkTable.row(cell.index().row).node()).removeClass('selected')\n\t})\n\t\n\t\n\t//note(@duncanmid): open url on keepress\n\t\n\t$('#bookmarks').on('key.dt', function(e, datatable, key, cell, originalEvent) {\n\t\t\n\t\t// spacebar\n\t\tif( key === 32 ) {\n\n\t\t\tif( !$('#add-bookmark, .col-toggle').is(\":focus\") ) {\n\t\t\t\t\n\t\t\t\tconst data = bookmarkTable.row(cell.index().row).data()\n\t\t\t\tshell.openExternal(data[3])\n\t\t\t}\n\t\t}\n\t})\n})\n"]}