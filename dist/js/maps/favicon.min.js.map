{"version":3,"names":[],"mappings":"","sources":["favicon.js"],"sourcesContent":["'use strict'\n\nconst {app} \t\t= require( 'electron' )\nconst path \t\t\t= require('path')\nconst fs \t\t\t= require( 'fs-extra' )\nconst nativeImage \t= require( 'electron' ).nativeImage\nconst axios \t\t= require( 'axios' ).default\nconst log  \t\t\t= require( 'electron-log' )\n\nconst dir \t\t\t= app.getPath( 'appData' ) + '/' + app.name\n\n\n\nmodule.exports.generate = function ( id, url ) {\n\t\n\tif( !fs.pathExistsSync( `${dir}/favicons/${id}.png` ) ) {\n\t\t\n\t\tlet bookmarkUrl = new URL( url ),\n\t\t\tdomain \t\t= bookmarkUrl.hostname,\n\t\t\ticonurl \t= `https://api.faviconkit.com/${domain}/32`,\n\t\t\tfile \t\t= `${dir}/favicons/${id}.png`,\n\t\t\tfile2x\t\t= `${dir}/favicons/${id}@2x.png`\n\n\t\taxios.get(iconurl,  { responseType: 'arraybuffer' })\n\t\t.then( function( response ) {\n\t\t\t\n\t\t\tconst buffer = Buffer.from(response.data, \"utf-8\")\n\t\t\t\n\t\t\tif(\n\t\t\t\tresponse.headers['content-type'].includes('png') ||\n\t\t\t\tresponse.headers['content-type'].includes('jpeg') ||\n\t\t\t\tresponse.headers['content-type'].includes('x-icon')\n\t\t\t) {\n\t\t\t\t\n\t\t\t\tlet imgpng = nativeImage.createFromBuffer(buffer, {\n\t\t\t\t\t\t\n\t\t\t\t\t\tscaleFactor: 1.0\n\t\t\t\t\t}).resize({\n\t\t\t\t\t\twidth: 16,\n\t\t\t\t\t\theight: 16,\n\t\t\t\t\t\tquality: 'best'\n\t\t\t\t\t}).toPNG()\n\t\t\t\t\n\t\t\t\tlet imgpng2x = nativeImage.createFromBuffer(buffer, {\n\t\t\t\t\t\t\n\t\t\t\t\t\tscaleFactor: 1.0\n\t\t\t\t\t}).resize({\n\t\t\t\t\t\twidth: 32,\n\t\t\t\t\t\theight: 32,\n\t\t\t\t\t\tquality: 'best'\n\t\t\t\t\t}).toPNG()\n\t\t\t\t\n\t\t\t\tfs.outputFileSync(file, imgpng, err => {\n\t\t\t\t\t\n\t\t\t\t\tif(err) log.info(err)\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\tfs.outputFileSync(file2x, imgpng2x, err => {\n\t\t\t\t\t\n\t\t\t\t\tif(err) log.info(err)\n\t\t\t\t})\n\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\tlet iconurl = 'https://www.google.com/s2/favicons?sz=32&domain_url=' + bookmarkUrl\n\t\t\t\n\t\t\t\taxios.get(iconurl,  { responseType: 'arraybuffer' })\n\t\t\t\t.then( function( response ) {\n\t\t\t\t\t\n\t\t\t\t\tconst buffer = Buffer.from(response.data, \"utf-8\")\n\t\t\t\t\t\n\t\t\t\t\tlet imgpng = nativeImage.createFromBuffer(buffer, {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tscaleFactor: 1.0\n\t\t\t\t\t\t}).resize({\n\t\t\t\t\t\t\twidth: 16,\n\t\t\t\t\t\t\theight: 16,\n\t\t\t\t\t\t\tquality: 'best'\n\t\t\t\t\t\t}).toPNG()\n\t\t\t\t\t\n\t\t\t\t\tlet imgpng2x = nativeImage.createFromBuffer(buffer, {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tscaleFactor: 1.0\n\t\t\t\t\t\t}).resize({\n\t\t\t\t\t\t\twidth: 32,\n\t\t\t\t\t\t\theight: 32,\n\t\t\t\t\t\t\tquality: 'best'\n\t\t\t\t\t\t}).toPNG()\n\t\t\t\t\t\n\t\t\t\t\tlet b64enc = Buffer.from(imgpng, 'binary').toString('base64')\n\t\t\t\t\t\n\t\t\t\t\tif( isNotDefaultIcon( b64enc ) ) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tfs.outputFileSync(file, imgpng, err => {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (err) log.info(err)\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\n\t\t\t\t\t\tfs.outputFileSync(file2x, imgpng2x, err => {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (err) log.info(err)\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch( err => log.info( `favicon error: ${err.message}` ) )\n\t\t\t}\n\t\t})\n\t\t.catch( err => log.info( `favicon error: ${err.message}` ) )\n\t}\n}\n\n\n\nmodule.exports.exists = function ( id ) {\n\t\n\tif( fs.pathExistsSync( `${dir}/favicons/${id}.png` ) ) {\n\t\t\n\t\treturn `${dir}/favicons/${id}.png`\n\t\t\n\t} else {\n\t\t\n\t\treturn path.join(__dirname, '../assets/png/iconTemplate.png') \n\t}\n}\n\n\n\nfunction isNotDefaultIcon( b64 ) {\n\t\n\treturn ( b64 === 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACs0lEQVQ4jaWTzU8bBxDFf7V31/baXn+sP2oDduxaCZFKqiKDEDSHKKLKiRs55JCPQ070zyGHinsrxbk0kXpBqsTBKQUbqa1AUCgFk0C8trv2YrNm1y69gJWoveWdZqR5b97MaOAj8clVMD//3FO1apGZfHbCtnoLetPMt4yuD0Dxu9uhoKckuYRnxdL+elyK1guF++ZAYH7+uadt68nc9fjTdud8LpdRY6lsWLXsPpLoJJNSWV7ebhxUdE3xSy/3/qgt+cTQcaFw3xQAqlYt8sWNoadnZu/B57cSI5m0ileWGB8bpnNmkU4qZFMR9fftY/W778u+XC7Kr7snz4AjB8BMPjthtLtzTx5NjGTSKgCW3Wd143Awa0yVEUUnjx9OjrQ653Mz+ewEgAPAOu8tXBsJxaa+TA0Itt3HtvuEAjIAHbNHs2USCnhIDYVi3a69MBDQm2Z+dnZU7Zi9DzZ896vrKF4BAK9H4MZnMfYrf3Pv3k1V1808gADQMkxfPKKgeAW8ssRwIshwIjggAzgdUK2fAhCPKBiG6Rs4APDKEgBT49d4c9LEsj90cwVRdAJwcZkLV3fer9SVRDSF4hX4+naOYrnCzmVRNhUhEZW5M5Wh3uyy86eG4ne3Bw7CIbm0vLzdeL/T2GgSrd5Gq7dZ3Thg7bdjACJBN69ebTbCQbk0EBBFYfGgomvFcuV/bQO8PWnS/weK5QrH1ZbmcouLAE4AR2C6k04GAz//cpiOfqoEUskALsmBKIpol4sbG02ys6/x7dLro6Df9aK0efTD4c6PhhNg8tZj+12tsZtIKNLr1QO1tHHkcPtccrN1xolmYJx2WVnZa/y0snsY9Lte7O3VlsKSWt3aKvT+80zT49n8uWV/o+tm3jjt+i4uLlD87rYaltdlt7C4VvqrHHjvmT4a/wJLYRPRy3Z+JAAAAABJRU5ErkJggg==' ) ? false : true\n}\n"],"file":"../favicon.min.js"}